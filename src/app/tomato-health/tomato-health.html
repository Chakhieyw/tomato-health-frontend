<div class="page">
  <div class="container" *ngIf="data as d">
    <!-- LEFT -->
    <aside class="left-panel">
      <header class="header">
        <div class="icon-circle">
          <svg viewBox="0 0 64 64">
            <circle cx="32" cy="36" r="22" fill="#ff7043" />
            <path
              d="M32 8c6 6 10 6 14 6-4 6-8 8-14 8s-10-2-14-8c4 0 8 0 14-6z"
              fill="#4caf50"
            />
          </svg>
        </div>
        <h2>Tomato health check</h2>
        <button class="logout-btn" (click)="logout()">ออกจากระบบ</button>
      </header>

      <div class="image-box" *ngIf="d.image_url">
        <img [src]="d.image_url" alt="Latest tomato image" />
      </div>

      <button class="refresh" (click)="loadData()">⟳ อัพเดทข้อมูลล่าสุด</button>
    </aside>

    <!-- RIGHT -->
    <main class="right-panel">
      <!-- STATUS -->
      <section
        class="status-box"
        [class.warning]="d.status === 'warning'"
        [class.normal]="d.status === 'normal'"
      >
        <div class="status-icon">
          <svg *ngIf="d.status === 'warning'" viewBox="0 0 24 24">
            <path
              fill="#facc15"
              d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"
            />
          </svg>

          <svg *ngIf="d.status === 'normal'" viewBox="0 0 24 24">
            <path
              fill="#22c55e"
              d="M9 16.2 4.8 12 3.4 13.4 9 19 21 7l-1.4-1.4z"
            />
          </svg>
        </div>

        <div class="status-text">
          <h3>{{ d.status === 'warning' ? 'พบโรคพืช' : 'สุขภาพดี' }}</h3>
          <p>ตรวจล่าสุด {{ d.time }} น.</p>
          <span class="badge">{{ d.status.toUpperCase() }}</span>
        </div>
      </section>

      <!-- DISEASE -->
      <section class="section">
        <h4>การตรวจโรค</h4>

        <div class="disease-box" *ngIf="d.status === 'warning'">
          <b>โรคที่ตรวจพบ</b>
          <p class="danger">
            <i>{{ d.disease || '-' }}</i>
            {{ d.disease_th || '' }}
          </p>
        </div>

        <div class="disease-box normal" *ngIf="d.status === 'normal'">
          ไม่พบโรคใด ๆ ขณะนี้
        </div>
      </section>

      <!-- TIME -->
      <section class="section">
        <h4>ข้อมูลเวลา</h4>

        <div class="time-grid">
          <div class="time-card">
            <label>วันที่ปัจจุบัน</label>
            <span>{{ currentDate }}</span>
          </div>

          <div class="time-card">
            <label>เวลาปัจจุบัน</label>
            <span>{{ currentTime }} น.</span>
          </div>

          <div class="time-card">
            <label>เวลาตรวจ</label>
            <span>{{ d.time }} น.</span>
          </div>

          <div class="time-card">
            <label>สถานะระบบ</label>
            <span class="online">{{ d.system_status }}</span>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>
